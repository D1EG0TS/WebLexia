function formatBytes(bytes){const sizes=["B","KB","MB","GB"];if(bytes===0)return"0 B";const i=Math.floor(Math.log(bytes)/Math.log(1024));return parseFloat((bytes/Math.pow(1024,i)).toFixed(i?1:0))+" "+sizes[i]}
function setDisabled(anchor,disabled){if(!anchor)return;if(disabled){anchor.classList.add("disabled");anchor.setAttribute("aria-disabled","true");anchor.addEventListener("click",preventClick,true)}else{anchor.classList.remove("disabled");anchor.removeAttribute("aria-disabled");anchor.removeEventListener("click",preventClick,true)}}
function preventClick(e){e.preventDefault()}
async function checkApkAvailability(){const btn=document.getElementById("apkButton");const statusEl=document.getElementById("apkStatus");const driveId=btn?.dataset?.driveId;const driveUrl=driveId?`https://drive.google.com/uc?export=download&id=${driveId}`:null;try{const res=await fetch("downloads/lex-ia.apk",{method:"GET",headers:{"Range":"bytes=0-0"},cache:"no-store"});if(res.ok){let size=0;const cr=res.headers.get("content-range");if(cr){const m=cr.match(/\/(\d+)/);if(m) size=Number(m[1]);}else{size=Number(res.headers.get("content-length"))||0;}statusEl.textContent="APK disponible"+(size?" Â· "+formatBytes(size):"");setDisabled(btn,false)}else{if(driveUrl){btn.href=driveUrl;statusEl.textContent="APK disponible en Drive";setDisabled(btn,false)}else{statusEl.textContent="Sube tu APK a downloads/lex-ia.apk";setDisabled(btn,true)}}}catch{if(driveUrl){btn.href=driveUrl;statusEl.textContent="APK disponible en Drive";setDisabled(btn,false)}else{statusEl.textContent="Sube tu APK a downloads/lex-ia.apk";setDisabled(btn,true)}}}
document.addEventListener("DOMContentLoaded",()=>{checkApkAvailability()})